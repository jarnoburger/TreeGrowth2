<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TreeGrowth.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="TreeGrowth.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Forest Fire Simulation - TreeGrowth.Avalonia"
        Width="1400" Height="900">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Save Settings" Command="{Binding SaveSettingsCommand}" HotKey="Ctrl+S">
                    <MenuItem.Icon>
                        <TextBlock Text="??" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Save Settings _As..." Command="{Binding SaveSettingsAsCommand}" HotKey="Ctrl+Shift+S">
                    <MenuItem.Icon>
                        <TextBlock Text="??" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Load Settings..." Command="{Binding LoadSettingsCommand}" HotKey="Ctrl+O">
                    <MenuItem.Icon>
                        <TextBlock Text="??" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Revert to Defaults" Command="{Binding RevertToDefaultsCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="?" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Click="OnExitClick" HotKey="Alt+F4">
                    <MenuItem.Icon>
                        <TextBlock Text="?" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- Main Content -->
        <Grid ColumnDefinitions="*,300" Background="#1e1e1e">
            <!-- Simulation View -->
            <Border Grid.Column="0" Margin="10" BorderBrush="#444" BorderThickness="1">
                <Image Source="{Binding SimulationImage}" Stretch="Uniform"/>
            </Border>

            <!-- Control Panel -->
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10" Spacing="10">
                    <!-- Status -->
                    <StackPanel Spacing="5">
                        <TextBlock Text="Status" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="{Binding StatusText}" Foreground="#4EC9B0"/>
                        <TextBlock Text="{Binding FpsText}" Foreground="#999"/>
                        <TextBlock Text="{Binding StatsText}" Foreground="#999" TextWrapping="Wrap"/>
                    </StackPanel>

                    <Separator Background="#444"/>

                    <!-- Controls -->
                    <StackPanel Spacing="5">
                        <TextBlock Text="Controls" FontWeight="Bold" FontSize="14"/>
                        <Button Content="{Binding ToggleButtonText}"
                                Command="{Binding ToggleSimulationCommand}"
                                HorizontalAlignment="Stretch"/>
                        <Button Content="Reset" Command="{Binding ResetSimulationCommand}" HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <Separator Background="#444"/>

                    <!-- Parameters -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Parameters" FontWeight="Bold" FontSize="14"/>
                        
                        <StackPanel Spacing="3">
                            <TextBlock Text="{Binding TreeGrowth, StringFormat='Tree Growth (p): {0:0.0000}'}"/>
                            <Slider Minimum="0" Maximum="0.05" Value="{Binding TreeGrowth}" 
                                    TickFrequency="0.001" IsSnapToTickEnabled="True"/>
                        </StackPanel>

                        <StackPanel Spacing="3">
                            <TextBlock Text="{Binding Lightning, StringFormat='Lightning (f): {0:0.000000}'}"/>
                            <Slider Minimum="0.000001" Maximum="0.0001" Value="{Binding Lightning}"
                                    TickFrequency="0.000001" IsSnapToTickEnabled="True"/>
                        </StackPanel>

                        <StackPanel Spacing="3">
                            <TextBlock Text="{Binding StepsPerFrame, StringFormat='Steps/Frame: {0:n0}'}"/>
                            <Slider Minimum="100" Maximum="10000" Value="{Binding StepsPerFrame}"
                                    TickFrequency="100" IsSnapToTickEnabled="True"/>
                        </StackPanel>

                        <StackPanel Spacing="3">
                            <TextBlock Text="Seed"/>
                            <TextBox Text="{Binding Seed}"/>
                        </StackPanel>
                    </StackPanel>

                    <Separator Background="#444"/>

                    <!-- Overlay Controls -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Overlay Image" FontWeight="Bold" FontSize="14"/>
                        
                        <Button Content="Load Overlay Image..." 
                                Command="{Binding LoadOverlayImageCommand}"
                                HorizontalAlignment="Stretch"/>
                        
                        <CheckBox Content="Show Overlay" 
                                  IsChecked="{Binding ShowOverlay}"
                                  IsEnabled="{Binding HasOverlayImage}"/>
                        
                        <StackPanel Spacing="3" IsVisible="{Binding HasOverlayImage}">
                            <TextBlock Text="Loaded:" Foreground="#999"/>
                            <TextBlock Text="{Binding OverlayFilePath}" 
                                       Foreground="#4EC9B0" 
                                       TextWrapping="Wrap"/>
                            <Button Content="Clear Overlay" 
                                    Command="{Binding ClearOverlayImageCommand}"
                                    HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </StackPanel>

                    <Separator Background="#444"/>

                    <!-- Colors -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Colors" FontWeight="Bold" FontSize="14"/>
                        
                        <ComboBox ItemsSource="{Binding ColorPresetNames}"
                                  SelectedIndex="{Binding SelectedPresetIndex}"
                                  HorizontalAlignment="Stretch"/>
                        
                        <Button Content="Apply Color Preset" 
                                Command="{Binding ApplyColorPresetCommand}"
                                HorizontalAlignment="Stretch"/>
                    </StackPanel>

                    <Separator Background="#444"/>

                    <!-- Perlin Noise -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Perlin Noise Distribution" FontWeight="Bold" FontSize="14"/>
                        
                        <CheckBox Content="Enable Perlin Noise" IsChecked="{Binding UsePerlinNoise}"/>
                        
                        <StackPanel Spacing="3" IsEnabled="{Binding UsePerlinNoise}">
                            <StackPanel Spacing="3">
                                <TextBlock Text="{Binding NoiseScale, StringFormat='Scale: {0:0.0}'}"/>
                                <Slider Minimum="1" Maximum="200" Value="{Binding NoiseScale}"/>
                            </StackPanel>

                            <StackPanel Spacing="3">
                                <TextBlock Text="{Binding NoiseOctaves, StringFormat='Octaves: {0}'}"/>
                                <Slider Minimum="1" Maximum="8" Value="{Binding NoiseOctaves}"
                                        TickFrequency="1" IsSnapToTickEnabled="True"/>
                            </StackPanel>

                            <StackPanel Spacing="3">
                                <TextBlock Text="{Binding NoiseThreshold, StringFormat='Threshold: {0:0.00}'}"/>
                                <Slider Minimum="0" Maximum="1" Value="{Binding NoiseThreshold}"
                                        TickFrequency="0.01" IsSnapToTickEnabled="True"/>
                            </StackPanel>

                            <StackPanel Spacing="3">
                                <TextBlock Text="{Binding NoiseStrength, StringFormat='Strength: {0:P0}'}"/>
                                <Slider Minimum="0" Maximum="1" Value="{Binding NoiseStrength}"
                                        TickFrequency="0.05" IsSnapToTickEnabled="True"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </DockPanel>
</Window>
